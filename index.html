<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Maklumat Murid - SK Cherating</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

    <style>
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Make table headers sticky */
        th { position: sticky; top: 0; z-index: 20; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-2 md:p-6">

    <div class="max-w-[95%] mx-auto bg-white rounded-xl shadow-xl overflow-hidden">
        
        <div class="bg-blue-800 p-6 text-white flex flex-col md:flex-row justify-between items-center shadow-md">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold flex items-center gap-3">
                    <i class="fas fa-school text-yellow-400"></i> 
                    SK Cherating
                </h1>
                <p class="mt-1 text-blue-200 text-sm tracking-wide font-medium">Sistem Maklumat Murid & Contact Directory</p>
            </div>
            <div class="mt-4 md:mt-0 bg-blue-900 bg-opacity-50 px-4 py-2 rounded-lg text-sm border border-blue-700">
                <i class="fas fa-users mr-2"></i> <span id="totalStudentsBadge" class="font-bold">0</span> Records
            </div>
        </div>

        <div class="p-6 bg-gray-50 border-b border-gray-200">
            <div class="grid grid-cols-1 md:grid-cols-12 gap-4 items-end">
                
                <div class="md:col-span-3">
                    <label class="block text-gray-700 text-xs font-bold mb-2 uppercase tracking-wide">
                        1. Select Class
                    </label>
                    <div class="relative">
                        <select id="classSelect" onchange="handleClassChange()" class="w-full pl-3 pr-8 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none bg-white shadow-sm text-sm">
                            <option value="">-- Select --</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
                            <i class="fas fa-chevron-down text-xs"></i>
                        </div>
                    </div>
                </div>

                <div class="md:col-span-4">
                    <label class="block text-gray-700 text-xs font-bold mb-2 uppercase tracking-wide">
                        2. Search (Name/ID/Phone)
                    </label>
                    <div class="relative">
                        <input type="text" 
                               id="studentInput" 
                               onkeyup="renderTable()" 
                               disabled 
                               placeholder="Select class first..." 
                               class="w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-100 disabled:opacity-60 cursor-not-allowed shadow-sm text-sm transition">
                        <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center px-3 text-gray-400">
                            <i class="fas fa-search text-xs"></i>
                        </div>
                    </div>
                </div>

                <div class="md:col-span-5 flex gap-2 justify-end">
                    <button onclick="exportToExcel()" id="btnExcel" disabled class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition shadow-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                    
                    <button onclick="exportToPDF()" id="btnPdf" disabled class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition shadow-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>

                    <button onclick="resetApp()" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 text-sm font-medium rounded-lg transition shadow-sm" title="Reset Filters">
                        <i class="fas fa-sync-alt"></i> Reset
                    </button>
                </div>

            </div>
        </div>

        <div class="p-0 border-t border-gray-200">
            <div class="overflow-auto h-[65vh]">
                <table class="min-w-full leading-normal text-sm" id="studentTable">
                    <thead class="bg-gray-100 text-gray-600">
                        <tr>
                            <th class="px-4 py-3 border-b-2 border-gray-200 text-left text-xs font-bold uppercase tracking-wider w-10">No.</th>
                            <th class="px-4 py-3 border-b-2 border-gray-200 text-left text-xs font-bold uppercase tracking-wider min-w-[200px]">Student Name</th>
                            <th class="px-4 py-3 border-b-2 border-gray-200 text-left text-xs font-bold uppercase tracking-wider min-w-[120px]">MyKid / ID</th>
                            <th class="px-4 py-3 border-b-2 border-gray-200 text-center text-xs font-bold uppercase tracking-wider bg-blue-50">G1 Office</th>
                            <th class="px-4 py-3 border-b-2 border-gray-200 text-center text-xs font-bold uppercase tracking-wider bg-blue-50">G1 Mobile</th>
                            <th class="px-4 py-3 border-b-2 border-gray-200 text-center text-xs font-bold uppercase tracking-wider bg-green-50">G2 Office</th>
                            <th class="px-4 py-3 border-b-2 border-gray-200 text-center text-xs font-bold uppercase tracking-wider bg-green-50">G2 Mobile</th>
                        </tr>
                    </thead>
                    <tbody id="resultsBody" class="bg-white">
                        </tbody>
                </table>

                <div id="emptyState" class="text-center py-20">
                    <div class="inline-block p-4 rounded-full bg-blue-50 text-blue-400 mb-4">
                        <i class="fas fa-address-book text-4xl"></i>
                    </div>
                    <h3 class="text-lg font-medium text-gray-900" id="emptyStateTitle">Student Directory</h3>
                    <p class="text-gray-500 mt-1" id="emptyStateDesc">Select a class to view student details and contact information.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. DATA PARSING ---
        // Data structure: Name | ID | Class | Phones (Space separated if parsing fails)
        // Since the user provided data often has mashed numbers, the visual table will separate them sequentially.
        
        const rawDataString = `
AARDI BIN MUHAMAD HANIF,201016060165,PRASEKOLAH AL BIRUNI,16616667,195833227,137045204,45204
AMALIA HUMAIRA BINTI ZAHARI,211006110818,PRASEKOLAH AL BIRUNI,95819115,179847672,95819133,1155098389
CHE AMMAR ARYAN BIN CHE ZANUDIN,200725110415,PRASEKOLAH AL BIRUNI,,,,
CHE KASYAF ARYYAN BIN CHE MOHD FAIZAL ANUAR,200707110315,PRASEKOLAH AL BIRUNI,95819922,115584420,0143212900,
FAIQ QHALISH BIN FAIZ ISKANDAR,200730110735,PRASEKOLAH AL BIRUNI,95819133,166114339,,
MUHAMMAD AALI BIN AZMAN,200407060213,PRASEKOLAH AL BIRUNI,95819133,,,
MUHAMMAD AMMAR ZIQRI BIN ROSLAN,200820110405,PRASEKOLAH AL BIRUNI,179042606,129461696,1161219143,
MUHAMMAD HAFIZ AARIZ BIN FADZLI SHAH,210223110553,PRASEKOLAH AL BIRUNI,355690364,1139189356,1161008913,
MUHAMMAD HAMIZAN BIN MOHD NAPI,200625110581,PRASEKOLAH AL BIRUNI,139431964,138258214,,
MUHAMMAD ILYAS DANIAL BIN MUHAMMAD RIDZAN,201215060563,PRASEKOLAH AL BIRUNI,1137458200,1137485161,,
MUHAMMAD KHABIR SUFYAN BIN MOHD FARIZ ISKANDAR,210419110125,PRASEKOLAH AL BIRUNI,167227539,1155934382,1139345830,
NAZNEEN ARWA BINTI MOHD HANIFF,211003130346,PRASEKOLAH AL BIRUNI,65821092,139709722,69819115,148331775
NIK AMNA HUWAIDA BINTI NIK MOHD HAFIS,200911060300,PRASEKOLAH AL BIRUNI,125578660,,,
NIK ILYAS BIN AMIRUDDIN,200615110529,PRASEKOLAH AL BIRUNI,32113006,1116103487,21121950351,
NOR AISY ZAFRAN BIN NOR ZULHAIRIE,210112110315,PRASEKOLAH AL BIRUNI,135855999,1112963945,1112936503,
NOR PUTERI AWFIYA BINTI MUHAMAD ARIF,201105030558,PRASEKOLAH AL BIRUNI,1131820509,,,
NUR ANIS SUHADA BINTI MOHD KAMARUZAMAN,200813110650,PRASEKOLAH AL BIRUNI,,,,
NUR AYESHA QALEESYA BINTI MUHAMAD FAIZOL,210903060246,PRASEKOLAH AL BIRUNI,145290983,95825200,145301078,
NUR DHAIFAH URSHIA BINTI ABDUL RAZAK,201026060038,PRASEKOLAH AL BIRUNI,95838456,1128559553,95819115,194092358
NUR FAJAR HANANIA BINTI MUHAMAD HAFIZI,201215111148,PRASEKOLAH AL BIRUNI,1126029298,169417419,169417619,
NUR FAREESHA AIRA BINTI MUHAMMAD SHAIFUL AMIERUL,200629110618,PRASEKOLAH AL BIRUNI,1135693349,,,
NUR MARDHIAH SYAHINDAH BINTI MUHAMMAD SOFFIAN,200916110362,PRASEKOLAH AL BIRUNI,1126769036,199895707,109149036,
NUR SYAKILA AMEERA BINTI MOHAMAD SHAHRUL EFFIZAN,200603060958,PRASEKOLAH AL BIRUNI,95847333,109224128,178780976,
PUTERI NUR UMAIRAH BINTI IDRIS,200123060422,PRASEKOLAH AL BIRUNI,95819500,179985237,,
TUAN SYIFAA HUMAIRA BINTI TUAN AHMAD HAFISZA,201026060054,PRASEKOLAH AL BIRUNI,95673886,1129265599,199901573,
AHMAD ZAHAYDAN BIN AHMAD ZAFRI,201007110685,PRASEKOLAH AL KINDI,109204252,133352231,,
AINUHA HASYA SOPHIA BINTI MOHD FAIZAL,200812060436,PRASEKOLAH AL KINDI,106550030,1110377332,,
AISY ASSYIFA BINTI MOHD AZIZAN,200315060400,PRASEKOLAH AL KINDI,,,,
ANAS MATEEN BIN MOHD KAMARULZAMAN,200526110025,PRASEKOLAH AL KINDI,1135297417,,,
EL ZAYYAN ARSALAN BIN AMIN FIRDAUS,201005060493,PRASEKOLAH AL KINDI,,,,
ENGKU FARIS BIN ENGKU NOR ILHAM,211210110129,PRASEKOLAH AL KINDI,100199067447,,,
KHAYRA MELISSA BINTI MUHAMAD AQRAM HAKIM,201113060044,PRASEKOLAH AL KINDI,95834920,179252527,169789344,
MAHDEHA AMANI SOFEA BINTI ABDULLAH,200215110482,PRASEKOLAH AL KINDI,,,,
MUHAMMAD ADAM DANIAL BIN MOHD KHAIRUL ANUAR,201119110233,PRASEKOLAH AL KINDI,199960262,,,
MUHAMMAD ADAM IZZAT BIN FAHMI,210421060497,PRASEKOLAH AL KINDI,,,,
MUHAMMAD AFFAN NUH BIN ABDUL AZIZ,200926110307,PRASEKOLAH AL KINDI,,,,
MUHAMMAD AQEEF RIZQI BIN SHAHRUL NIZAM,201202060185,PRASEKOLAH AL KINDI,197056174,95916115,199875283,
MUHAMMAD DAIYAN HAZIQ BIN MOHD ROSTAM,210822060041,PRASEKOLAH AL KINDI,100199392139,199392139,,
MUHAMMAD DANISH HARIS BIN MUHAMMAD FIRDAUS,201018110103,PRASEKOLAH AL KINDI,95825200,139880674,129006273,
NAURA FATIMA BINTI MOHD ASRI,200807110144,PRASEKOLAH AL KINDI,196024900,192592459,,
NUR AAFIYAH ALISHA BINTI AMIRUL ASYRAF,200216060296,PRASEKOLAH AL KINDI,129513049,,,
NUR AIRIS ZULAIKHA BINTI MOHD SYAHRIZAI,200519110270,PRASEKOLAH AL KINDI,1129305617,,,
NUR ALYA DEANDRAA BINTI MOHD ZULFADLI,201030060532,PRASEKOLAH AL KINDI,182444933,182444933,199715034,
NUR FATIMAH AL ZAHHRA BINTI ZUWAIRI,211116060508,PRASEKOLAH AL KINDI,179538868,134661974,134661974,
NUR FELISHA DHAFWATULAISY BINTI AHMAD FAZIL,201020060758,PRASEKOLAH AL KINDI,1128938977,1164563472,,
NUR IENDAH AULIA BINTI MOHAMAD RAZALI,210606060434,PRASEKOLAH AL KINDI,199328474,179328474,,
NUR JASMINE NAILA BINTI MOHD NORHAFIZAN,200717060358,PRASEKOLAH AL KINDI,95825200,148395589,,
NUR SOFIA MEDINA BINTI MOHAMAD SHARULRIZAL,210411110438,PRASEKOLAH AL KINDI,95819115,1119780021,95825200,145484109
SAIDATUL NAYLA UYAINA BINTI MOHD SUFIAN,210709110326,PRASEKOLAH AL KINDI,1999908143,,,
SITI AISYAH HUMAIRA BINTI MUHAMMAD FIRDAUS,200510030098,PRASEKOLAH AL KINDI,98681102,197278854,197278854,
AFEF HARISH A/L JEFFRY,201230060107,PRASEKOLAH AL RAZI,95819087,139365957,134460740,
AUNI ZAFIRAH BINTI MOHD ZAMRI,200227110308,PRASEKOLAH AL RAZI,95835988,179451696,179192543,
DIAN NUR RAISYA BINTI MOHD RAHIMI,200130110088,PRASEKOLAH AL RAZI,,,,
EL DAYYAN ARSALAN BIN AMIN FIRDAUS,201005060549,PRASEKOLAH AL RAZI,,,,
IDRUS FAHMI BIN ISMARUDIN,200904060361,PRASEKOLAH AL RAZI,125909817,,,
MOHAMED SYAQEEF ELMAN BIN MOHAMED SYAFIQ,200810030065,PRASEKOLAH AL RAZI,1130911934,1130911934,1110695866,
MUHAMMAD ADAM DANISH BIN MOHD KHAIRUL ANUAR,201119110241,PRASEKOLAH AL RAZI,322030600,129393696,199960262,
MUHAMMAD AFWA FAKRI BIN ZUKRI,210921110155,PRASEKOLAH AL RAZI,177983846,177983846,,
MUHAMMAD AISY RAYQAL BIN MOHD RIDZUAN,200723060581,PRASEKOLAH AL RAZI,179269415,,,
MUHAMMAD ARSYAD RAYYAN BIN AZFARIZAL SHAZWAN,210509110305,PRASEKOLAH AL RAZI,111767694,111767694,11111118212,
MUHAMMAD EHSHAM BIN SAHARUDDIN,200426110255,PRASEKOLAH AL RAZI,142146037,,,
MUHAMMAD FAYYADH BIN MOHD FIRDAUS,200227110017,PRASEKOLAH AL RAZI,109446922,,,
MUHAMMAD NUR FAYYADH ANAQI BIN MOHD NUR KARIM,200125060151,PRASEKOLAH AL RAZI,179317058,1112723710,,
MUHAMMAD RAQIB RAYYAN BIN ROHAIZAT,201214060529,PRASEKOLAH AL RAZI,98633529,135843616,142015662,
NAYRA NUR INDAH BINTI MUHAMMAD HARRAZ NAUFAL JOHN,201112110388,PRASEKOLAH AL RAZI,,,,
NUR AAFIQAH ALISHA BINTI AMIRUL ASYRAF,200216060368,PRASEKOLAH AL RAZI,129513049,,,
NUR HANI FATINI BINTI MOHD KHAIRUL MUZZAMIR,211218110422,PRASEKOLAH AL RAZI,95863888,1136910602,94271111,1136910602
NUR IMAN AFEEYA BINTI ZAID,200424110358,PRASEKOLAH AL RAZI,95825200,129472454,143848470,
NUR SYAFINA BINTI ASHAARI,200715110534,PRASEKOLAH AL RAZI,199705021,1114949412,,
NURHAURA TASNEEM BINTI MUHAMMAD ZULFAHMY,200331060304,PRASEKOLAH AL RAZI,95826057,137319829,95819115,137013053
NURRAISHA QAIRINA BINTI ABD RAZAK,200905110404,PRASEKOLAH AL RAZI,139895462,,,
PUTERI BELLA SOFFIA BINTI AHMAD FIRDAUS,210702060602,PRASEKOLAH AL RAZI,129496626,142966472,,
RAJA HAKEEM IZZ ZIQRI BIN RAJA AZMAN,200507110281,PRASEKOLAH AL RAZI,199226261,199226261,104426261,
SHARIFAH DHIA LARA BINTI SYED FIRDAUS ADNIN,200901110212,PRASEKOLAH AL RAZI,102010036,,,
TUAN NUR AINURAH QISMEENA BINTI TUAN ROSLEE,200529110696,PRASEKOLAH AL RAZI,133694032,139215013,,
ABDUL RAYYAN MIKAIL BIN ABDUL RASHID,190612110287,TAHUN SATU AL BIRUNI,1136112758,139195538,,
AHMAD DANISH AQEEL BIN AHMAD BARDAIN,191219060177,TAHUN SATU AL BIRUNI,95833766,1137535583,,
AHMAD HAZRIN DANIAL BIN AHMAD ASRUL,190428110455,TAHUN SATU AL BIRUNI,,,,
ALYA ADRIANA BINTI MOHD RIZUAN,190131060290,TAHUN SATU AL BIRUNI,95863888,139556007,148012451,
HANA MEDINA BINTI MOHD. AIMAN NURHAKIM,190622110280,TAHUN SATU AL BIRUNI,95835205,149127971,,
KHALISH NAUFAL BIN KHAIRUL ARMAN,190330110369,TAHUN SATU AL BIRUNI,134895382,134805382,,
MOHAMAD AMMAR IRFAN BIN MOHAMAD SYARAFUDDIN,190917110579,TAHUN SATU AL BIRUNI,1126487007,179291108,179291108,
MOHAMAD ZULFAN NAIM KHALISH BIN MOHD ZULKARNAIN,190429060365,TAHUN SATU AL BIRUNI,95833601,1117984179,,
MUHAMAD AFEEF ILYAS BIN MUHAMAD GHADAFFI,191018110043,TAHUN SATU AL BIRUNI,133721803,,,
MUHAMAD NAQIB RASYDAN BIN MOHAMAD RASYID,191001060115,TAHUN SATU AL BIRUNI,95834134,184099006,184099006,
MUHAMMAD ADYAN NAUFAL BIN ABDUL HANIF,190705110083,TAHUN SATU AL BIRUNI,75951199,179118028,179071089,
MUHAMMAD AISY FIRDAUS BIN MUHAMAAD FITRI,191003110219,TAHUN SATU AL BIRUNI,95819115,139583264,,
MUHAMMAD DAYYAN ZAFFRAN BIN ABDULLAH,190502060717,TAHUN SATU AL BIRUNI,1131772384,,,
MUHAMMAD FIRAS RIZQI BIN MUHD FADZLI,190209110105,TAHUN SATU AL BIRUNI,137647543,137699320,,
MUHAMMAD IRFAN NAUFAL BIN MUHAMMAD ILYAS,190829110333,TAHUN SATU AL BIRUNI,95838387,1112154500,147957131,
MUHAMMAD NUH RIFQI BIN AHMAD BAZLI,190510110403,TAHUN SATU AL BIRUNI,95838811,139893046,35717777,179453046
MUHAMMAD RIZWAN HAQIMIE BIN ABDUL MUZIL,191127060663,TAHUN SATU AL BIRUNI,1162509889,196386023,,
MUHAMMAD UMAR AL-KHATTAB BIN MUHAMMAD FIRDAUS,191208060171,TAHUN SATU AL BIRUNI,95834027,1131904969,1111037644,
MUHAMMAD UMAR SHARIF BIN ZULKIFLI,190323060439,TAHUN SATU AL BIRUNI,199006669,187924505,,
NAURA AISYAH BINTI MOHD ASRI,190508110180,TAHUN SATU AL BIRUNI,196024900,192592459,,
NOR AIRA JANNAH BINTI MOHD ASNAWI,190319110616,TAHUN SATU AL BIRUNI,179231392,183747299,,
NUR AAIRA QAISARA BINTI MOHD RIZAL,190203060418,TAHUN SATU AL BIRUNI,1125772558,1117577894,,
NUR AIRA AMANI BINTI ALIAS,190115030438,TAHUN SATU AL BIRUNI,100199259603,,,
NUR ASSYIFA HANEEM BINTI MOHD IKBAL HAKIM,190225060558,TAHUN SATU AL BIRUNI,1135697756,136397756,136397756,
NUR AYRA AISYAH BINTI MOHD KHAIRI,190119110216,TAHUN SATU AL BIRUNI,36128201,1125593543,,
NUR FATHIA NAYLA BINTI MUHAMMAD YUSRI,190905110096,TAHUN SATU AL BIRUNI,1112793357,95855999,166513806,
NUR HUMAIRA BINTI MUHD LUQMAN,190527030530,TAHUN SATU AL BIRUNI,98631885,145176898,145264072,
NUR JASMINE HANA MEDINA BINTI HIZWAN FAZRI,190912110270,TAHUN SATU AL BIRUNI,179185385,,,
NUR QALESYA BINTI YUSOF,190703110020,TAHUN SATU AL BIRUNI,135071556,142966496,163348599,
NUR SOFEA MEDINA BINTI MOHD SYUFIAN,190415110296,TAHUN SATU AL BIRUNI,95855999,145152598,199798735,
NURDIYANA AWFIYAH BINTI ZULKIFLI,190928102478,TAHUN SATU AL BIRUNI,1160946092,1140771025,,
PUTERI EILYANA BINTI MUHAMMAD SHAFID,191110030484,TAHUN SATU AL BIRUNI,97431464,107194095,,
ROS AMIRA SAFIYA BINTI ABDULLAH,191112110736,TAHUN SATU AL BIRUNI,179554281,179554281,,
SITI NURAAFIYAH INSYIRAH BINTI ABU HASSAN,191230080902,TAHUN SATU AL BIRUNI,14506651,179195893,,
SITI SABARISHA BINTI MOHD SALEH,190403110766,TAHUN SATU AL BIRUNI,189155987,189155987,,
WAN MUHAMMAD AMZAR BIN WAN AZMAN,190724110249,TAHUN SATU AL BIRUNI,1139134274,1137461330,,
`;

        const students = [];

        function parseRawData() {
            // Split line by line
            const lines = rawDataString.trim().split('\n');
            
            lines.forEach(line => {
                // The data is comma separated based on my reconstruction above
                const cols = line.split(',');
                if (cols.length >= 3) {
                    let formattedClass = cols[2]
                        .replace("TAHUN SATU", "Tahun 1")
                        .replace("TAHUN DUA", "Tahun 2")
                        .replace("TAHUN TIGA", "Tahun 3")
                        .replace("TAHUN EMPAT", "Tahun 4")
                        .replace("TAHUN LIMA", "Tahun 5")
                        .replace("TAHUN ENAM", "Tahun 6")
                        .replace("PRASEKOLAH", "Prasekolah");
                    
                    // Title Case Class
                    formattedClass = formattedClass.replace(/\w\S*/g, (txt) => {
                        return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
                    });

                    students.push({
                        name: cols[0].trim(),
                        id: cols[1].trim(),
                        class: formattedClass,
                        p1o: cols[3] ? cols[3].trim() : "",
                        p1m: cols[4] ? cols[4].trim() : "",
                        p2o: cols[5] ? cols[5].trim() : "",
                        p2m: cols[6] ? cols[6].trim() : ""
                    });
                }
            });
        }

        // --- 2. INITIALIZATION ---
        const classSelect = document.getElementById('classSelect');
        const studentInput = document.getElementById('studentInput');
        const resultsBody = document.getElementById('resultsBody');
        const emptyState = document.getElementById('emptyState');
        const totalBadge = document.getElementById('totalStudentsBadge');
        const btnExcel = document.getElementById('btnExcel');
        const btnPdf = document.getElementById('btnPdf');

        function init() {
            parseRawData();
            totalBadge.textContent = students.length;

            const uniqueClasses = [...new Set(students.map(s => s.class))].sort((a, b) => {
                const yearOrder = { "Prasekolah": 0, "Tahun 1": 1, "Tahun 2": 2, "Tahun 3": 3, "Tahun 4": 4, "Tahun 5": 5, "Tahun 6": 6 };
                const getYear = (str) => {
                    for (const key in yearOrder) if(str.startsWith(key)) return yearOrder[key];
                    return 99;
                };
                const yearA = getYear(a);
                const yearB = getYear(b);
                if (yearA !== yearB) return yearA - yearB;
                return a.localeCompare(b);
            });

            uniqueClasses.forEach(cls => {
                const option = document.createElement('option');
                option.value = cls;
                option.textContent = cls;
                classSelect.appendChild(option);
            });
        }

        // --- 3. FILTER LOGIC ---

        function getFilteredStudents() {
            const selectedClass = classSelect.value;
            const searchTerm = studentInput.value.toLowerCase().trim();

            if (!selectedClass) return [];

            return students.filter(s => {
                if (s.class !== selectedClass) return false;
                if (searchTerm.length > 0) {
                    return s.name.toLowerCase().includes(searchTerm) || 
                           s.id.includes(searchTerm) ||
                           s.p1m.includes(searchTerm) ||
                           s.p2m.includes(searchTerm);
                }
                return true;
            }).sort((a, b) => a.name.localeCompare(b.name));
        }

        function handleClassChange() {
            const selectedClass = classSelect.value;
            studentInput.value = '';
            
            if (!selectedClass) {
                studentInput.disabled = true;
                studentInput.classList.add('bg-gray-100', 'cursor-not-allowed');
                studentInput.classList.remove('bg-white');
                studentInput.placeholder = "Select class first...";
                btnExcel.disabled = true;
                btnPdf.disabled = true;
                renderTable(); 
                return;
            }

            studentInput.disabled = false;
            studentInput.classList.remove('bg-gray-100', 'cursor-not-allowed');
            studentInput.classList.add('bg-white');
            studentInput.placeholder = "Search Name, ID or Phone...";
            studentInput.focus();
            
            renderTable();
        }

        function renderTable() {
            const dataToRender = getFilteredStudents();
            resultsBody.innerHTML = '';

            // Update Buttons State
            if (dataToRender.length > 0) {
                btnExcel.disabled = false;
                btnPdf.disabled = false;
                emptyState.style.display = 'none';
            } else {
                btnExcel.disabled = true;
                btnPdf.disabled = true;
                emptyState.style.display = 'block';
                return;
            }

            dataToRender.forEach((student, index) => {
                const row = document.createElement('tr');
                row.className = "hover:bg-blue-50 transition duration-150 border-b border-gray-100";
                
                row.innerHTML = `
                    <td class="px-4 py-3 text-gray-500 font-mono text-center">
                        ${index + 1}
                    </td>
                    <td class="px-4 py-3 font-medium text-gray-900">
                        ${student.name}
                    </td>
                    <td class="px-4 py-3 text-gray-600 font-mono text-xs">
                        <span class="bg-gray-100 px-2 py-1 rounded border border-gray-200">${student.id}</span>
                    </td>
                    <td class="px-4 py-3 text-center text-gray-500 text-xs">
                        ${student.p1o || '-'}
                    </td>
                    <td class="px-4 py-3 text-center font-medium text-blue-700 text-xs">
                        ${student.p1m || '-'}
                    </td>
                    <td class="px-4 py-3 text-center text-gray-500 text-xs">
                        ${student.p2o || '-'}
                    </td>
                    <td class="px-4 py-3 text-center font-medium text-green-700 text-xs">
                        ${student.p2m || '-'}
                    </td>
                `;
                resultsBody.appendChild(row);
            });
        }

        function resetApp() {
            classSelect.value = "";
            handleClassChange();
        }

        // --- 4. EXPORT FUNCTIONS ---

        function exportToExcel() {
            const data = getFilteredStudents();
            if (data.length === 0) return alert("No data to export!");

            // Format data for Excel
            const excelData = data.map((s, i) => ({
                "No": i + 1,
                "Name": s.name,
                "ID": s.id,
                "Class": s.class,
                "G1 Office": s.p1o,
                "G1 Mobile": s.p1m,
                "G2 Office": s.p2o,
                "G2 Mobile": s.p2m
            }));

            const ws = XLSX.utils.json_to_sheet(excelData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Students");

            const className = classSelect.value.replace(/\s+/g, '_');
            XLSX.writeFile(wb, `SK_Cherating_${className}_Contact_List.xlsx`);
        }

        function exportToPDF() {
            const data = getFilteredStudents();
            if (data.length === 0) return alert("No data to export!");

            const { jsPDF } = window.jspdf;
            // Landscape mode ('l') for better column fit
            const doc = new jsPDF('l', 'mm', 'a4');

            // Header
            doc.setFontSize(16);
            doc.text("SK CHERATING - Student Contact Directory", 14, 15);
            doc.setFontSize(11);
            doc.text(`Class: ${classSelect.value}`, 14, 22);
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 14, 27);

            // Table Data
            const tableBody = data.map((s, i) => [
                i + 1,
                s.name,
                s.id,
                s.p1o,
                s.p1m,
                s.p2o,
                s.p2m
            ]);

            doc.autoTable({
                head: [['No', 'Name', 'ID', 'G1 Office', 'G1 Mobile', 'G2 Office', 'G2 Mobile']],
                body: tableBody,
                startY: 32,
                theme: 'grid',
                styles: { fontSize: 8, cellPadding: 2 },
                headStyles: { fillColor: [30, 64, 175], textColor: 255, halign: 'center' }, // Blue header
                columnStyles: {
                    0: { cellWidth: 10, halign: 'center' },
                    2: { cellWidth: 30, halign: 'center' }, // ID
                    3: { halign: 'center' },
                    4: { halign: 'center' },
                    5: { halign: 'center' },
                    6: { halign: 'center' }
                }
            });

            const className = classSelect.value.replace(/\s+/g, '_');
            doc.save(`SK_Cherating_${className}_Contacts.pdf`);
        }

        // Initialize
        init();

    </script>
</body>
</html>
